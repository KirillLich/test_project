name: STUDY PROJECT CI

# Триггер: запускать этот workflow при каждом пуше в ветку "main"
on:
  push:
    branches: [ "main" ]

# Задачи, которые нужно выполнить
jobs:
  # Название задачи 
  build-and-push:
    # На какой виртуальной машине выполнять
    runs-on: ubuntu-latest
    
    # Шаги, из которых состоит задача
    steps:
      # Шаг 1: Клонируем код нашего репозитория на виртуальную машину
      - name: Checkout repository
        uses: actions/checkout@v4

      # Шаг 2: Логинимся на Docker Hub, используя секреты
      - name: Log in to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      # Шаг 3: Собираем и пушим Docker-образ
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          # Контекст для сборки (где лежит Dockerfile) - "." означает корень проекта
          context: .
          # Говорим, что нужно не только собрать, но и запушить
          push: true
          # Имя и тег для нашего образа. 
          tags: liiich/test_project:latest